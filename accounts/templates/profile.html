{% extends 'base.html' %}

{% block body %}
        <!--=====================================
                    BANNER PART START
        =======================================-->
        <section class="inner-section single-banner" style="background: url(images/single-banner.jpg) no-repeat center;">
            <div class="container">
                <h2>my profile</h2>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">profile</li>
                </ol>
            </div>
        </section>
        <!--=====================================
                    BANNER PART END
        =======================================-->

        <!--=====================================
                    PROFILE PART START
        =======================================-->
        <section class="inner-section profile-part">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="account-card">
                            <div class="account-title">
                                <h4>Your Profile</h4>
                                <button data-bs-toggle="modal" data-bs-target="#profile-edit">edit profile</button>
                            </div>
                            <div class="account-content">
                                <div class="row">
                                    <div class="col-lg-2">
                                        <div class="profile-image">
                                            <a href="#"><img src="{{profile.image.url}}" alt="user"></a>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label class="form-label">name</label>
                                            <input class="form-control" type="text" value="{{profile.user}}">
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4">
                                        <div class="form-group">
                                            <label class="form-label">Email</label>
                                            <input class="form-control" type="email" value="{{profile.user.email}}">
                                        </div>
                                    </div>
                                    <div class="col-lg-2">
                                        <div class="profile-btn">
                                            <a href="change-password.html">change pass.</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="account-card">
                            <div class="account-title">
                                <h4>contact number</h4>
                                <button data-bs-toggle="modal" data-bs-target="#contact-add">add contact</button>
                            </div>
                            <div id="contactNumbersSection">
                                {% include "include/real-time/contact_numbers_section.html" %}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="account-card">
                            <div class="account-title">
                                <h4>delivery address</h4>
                                <button data-bs-toggle="modal" data-bs-target="#address-add">add address</button>
                            </div>
                            <div class="account-content">
                                <div class="row">
                                    {% for address in user_adress %}
                                        <div class="col-md-6 col-lg-4 alert fade show">
                                            <div class="profile-card address  {% if address.active %}active{% endif %}" data-id='{{address.id}}'>
                                                <h6>{{address.type}}</h6>
                                                <p>{{address.country}}, {{address.city}}, {{address.state}}. {{address.region}}, {{address.street}}, {{address.notes}}</p>
                                                <ul class="user-action">
                                                    <li><button class="edit icofont-edit" title="Edit This" data-bs-toggle="modal" data-bs-target="#address-edit-{{address.id}}"></button></li>
                                                    <li><button class="trash icofont-ui-delete" title="Remove This" data-bs-dismiss="alert"></button></li>
                                                </ul>
                                            </div>
                                        </div>


                                        <!-- address edit form -->
                                        <div class="modal fade" id="address-edit-{{address.id}}">
                                            <div class="modal-dialog modal-dialog-centered"> 
                                                <div class="modal-content">
                                                    <button class="modal-close" data-bs-dismiss="modal"><i class="icofont-close"></i></button>
                                                    <form class="modal-form">
                                                        <div class="form-title">
                                                            <h3>edit address info</h3>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="form-label">title</label>
                                                            <select class="form-select">
                                                                <option value="home" {% if address.type == 'Home' %}selected{% endif %}>home</option>
                                                                <option value="bussiness" {% if address.type == 'Bussiness' %}selected{% endif %}>bussiness</option>
                                                                <option value="office" {% if address.type == 'Office' %}selected{% endif %}>office</option>
                                                                <option value="others" {% if address.type == 'Others' %}selected{% endif %}>others</option>
                                                            </select>        
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="form-label">address</label>
                                                            <textarea class="form-control" placeholder="jalkuri, fatullah, narayanganj-1420. word no-09, road no-17/A"></textarea>
                                                        </div>
                                                        <button class="form-btn" type="submit">save address info</button>
                                                    </form>
                                                </div> 
                                            </div> 
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--=====================================
                    PROFILE PART END
        =======================================-->


        <!--=====================================
                    MODAL ADD FORM START
        =======================================-->
        <!-- contact add form -->
        <div class="modal fade" id="contact-add">
            <div class="modal-dialog modal-dialog-centered"> 
                <div class="modal-content">
                    <button class="modal-close" data-bs-dismiss="modal"><i class="icofont-close"></i></button>
                    <form class="modal-form" id="contactAddForm" method="post" action="{% url 'accounts:add_profile_number' %}">
                        <div class="form-title">
                            <h3>add new contact</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">title</label>
                            <select name="type" class="form-select">
                                <option value="Home" {% if number.type == 'Home' %}selected{% endif %}>home</option>
                                <option value="Bussiness" {% if number.type == 'Bussiness' %}selected{% endif %}>bussiness</option>
                                <option value="Office" {% if number.type == 'Office' %}selected{% endif %}>office</option>
                                <option value="Others" {% if number.type == 'Others' %}selected{% endif %}>others</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">number</label>
                            <input class="form-control" type="text" name="phone_number" required placeholder="Enter your number">
                        </div>
                        <button class="form-btn" type="submit">save contact info</button>
                    </form>
                </div> 
            </div> 
        </div>

        <!-- address add form -->
        <div class="modal fade" id="address-add">
            <div class="modal-dialog modal-dialog-centered"> 
                <div class="modal-content">
                    <button class="modal-close" data-bs-dismiss="modal"><i class="icofont-close"></i></button>
                    <form class="modal-form">
                        <div class="form-title">
                            <h3>add new address</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">title</label>
                            <select class="form-select">
                                <option selected>choose title</option>
                                <option value="home">home</option>
                                <option value="office">office</option>
                                <option value="Bussiness">Bussiness</option>
                                <option value="academy">academy</option>
                                <option value="others">others</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">address</label>
                            <textarea class="form-control" placeholder="Enter your address"></textarea>
                        </div>
                        <button class="form-btn" type="submit">save address info</button>
                    </form>
                </div> 
            </div> 
        </div>

        <!-- payment add form -->
        <div class="modal fade" id="payment-add">
            <div class="modal-dialog modal-dialog-centered"> 
                <div class="modal-content">
                    <button class="modal-close" data-bs-dismiss="modal"><i class="icofont-close"></i></button>
                    <form class="modal-form">
                        <div class="form-title">
                            <h3>add new payment</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">card number</label>
                            <input class="form-control" type="text" placeholder="Enter your card number">
                        </div>
                        <button class="form-btn" type="submit">save card info</button>
                    </form>
                </div> 
            </div> 
        </div>
        <!--=====================================
                    MODAL ADD FORM END
        =======================================-->

        
        <!--=====================================
                    MODAL EDIT FORM START
        =======================================-->
        <!-- profile edit form -->
        <div class="modal fade" id="profile-edit">
            <div class="modal-dialog modal-dialog-centered"> 
                <div class="modal-content">
                    <button class="modal-close" data-bs-dismiss="modal"><i class="icofont-close"></i></button>
                    <form class="modal-form">
                        <div class="form-title">
                            <h3>edit profile info</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">profile image</label>
                            <input class="form-control" type="file">
                        </div>
                        <div class="form-group">
                            <label class="form-label">name</label>
                            <input class="form-control" type="text" value="Nour Mohamed">
                        </div>
                        <div class="form-group">
                            <label class="form-label">email</label>
                            <input class="form-control" type="text" value="mironcoder@gmail.com">
                        </div>
                        <button class="form-btn" type="submit">save profile info</button>
                    </form>
                </div> 
            </div> 
        </div>

        <!-- contact edit form -->
        <div class="modal fade contact-edit-modal" id="contact-edit">
            <div class="modal-dialog modal-dialog-centered"> 
                <div class="modal-content">
                    <button class="modal-close" data-bs-dismiss="modal"><i class="icofont-close"></i></button>
                    <form class="modal-form" id="contactEditForm" method="post" action="{% url 'accounts:edit_profile_number' %}">
                        {% comment %} {% csrf_token %} {% endcomment %}
                        <div class="form-title">
                            <h3>edit contact info</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">title</label>
                            <select id="editTypeSelect" class="form-select" name="type">
                                <option value="Home">Home</option>
                                <option value="Bussiness">Bussiness</option>
                                <option value="Office">Office</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">number</label>
                            <input required id="editNumberInput" class="form-control" name="phone_number" type="text">
                            <input type="hidden" id="numberId" name="id" value="">
                        </div>
                        <button class="form-btn" type="submit">save contact info</button>
                    </form>
                </div> 
            </div> 
        </div>



        <!--=====================================
                    MODAL EDIT FORM END
        =======================================-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>



            $(document).ready(function(e){
                $('#contactNumbersSection').on('click', '.profile-card.contact', function(){
                    $('.profile-card.contact').removeClass('active');
                    $(this).addClass('active');

                    const csrftoken = getCookie('csrftoken');
                    var numberId = $(this).data('id');

                    $.ajax({
                        type: 'post',
                        url:'/accounts/profile/edit',
                        data: {'number-id':numberId} ,
                        headers:{"X-CSRFToken": csrftoken }, 
                        dataType:'json',
                        success:function(response){
                            console.log('added');
                        },
                        error:function(err){
                            console.log(err);
                        }
                    })
                });


                $('#contactNumbersSection').on('click', '.profile-card.address', function(){
                    $('.profile-card.address').removeClass('active');
                    $(this).addClass('active');

                    const csrftoken = getCookie('csrftoken');
                    var addressId = $(this).data('id');

                    $.ajax({
                        type: 'post',
                        url:'/accounts/profile/edit',
                        data: {'address-id':addressId} ,
                        headers:{"X-CSRFToken": csrftoken }, 
                        dataType:'json',
                        success:function(response){
                            console.log('added');
                        },
                        error:function(err){
                            console.log(err);
                        }
                    })
                });

                $('#contactNumbersSection').on('click', '.edit-btn', function(e){
                    const phoneType = $(this).closest('div').find('#phoneType').text();
                    const phoneNumber = $(this).closest('div').find('#phoneNumber').text();
                    const numberId = $(this).closest('div').data('id');
                    

                    $('#editTypeSelect').val(phoneType);
                    $('#editNumberInput').val(phoneNumber);
                    $('#numberId').val(numberId);

                })
                $('#contactAddForm').on('submit', function(e){
                    e.preventDefault();
                    const csrftoken = getCookie('csrftoken');

                    $.ajax({
                        type:$(this).attr('method'),
                        url:$(this).attr('action'),
                        data:$(this).serialize(),
                        headers:{"X-CSRFToken": csrftoken }, 
                        dataType:'json',
                        success:function(response){
                            $('#contactNumbersSection').html(response['result']);
                            $('#contact-add').modal('hide');
                            $('#contactAddForm')[0].reset();


                        },
                        error:function(err){
                            console.log(err);
                        }
                    })
                })


                $('#contactEditForm').on('submit', function(e){
                    e.preventDefault();
                    const csrftoken = getCookie('csrftoken');
                    

                    $.ajax({
                        type:$(this).attr('method'),
                        url:$(this).attr('action'),
                        data:$(this).serialize(),
                        headers:{"X-CSRFToken": csrftoken }, 
                        dataType:'json',
                        success:function(response){
                            $('.contact-edit-modal').modal('hide');
                            $('#contactNumbersSection').html(response['result']);

                            
                        },
                        error:function(err){
                            console.log(err);
                        }
                    })
                })
            })
        </script>

{% endblock body %}



